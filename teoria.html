<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Material de clase ‚Äì Teor√≠a (12 Unidades)</title>
  <meta name="description" content="Material de teor√≠a por unidades. Navegaci√≥n, buscador y modo oscuro/claro." />

  <style>
    :root{
      --font-main: system-ui, -apple-system, "Segoe UI", sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --r-lg: 22px; --r-md: 14px; --r-pill: 999px;
    }
    :root[data-theme="dark"]{
      --bg: radial-gradient(circle at top, #0b1020 0, #020617 60%);
      --panel: rgba(2, 6, 23, 0.85);
      --card: rgba(15, 23, 42, 0.6);
      --card2: rgba(15, 23, 42, 0.78);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: rgba(148, 163, 184, 0.28);
      --border2: rgba(148, 163, 184, 0.45);
      --accent: #22c55e;
      --accent2: rgba(34, 197, 94, 0.18);
      --shadow: 0 26px 70px rgba(0,0,0,0.55);
      --codebg: #020617;
    }
    :root[data-theme="light"]{
      --bg: radial-gradient(circle at top, #e8fff3 0, #ffffff 55%);
      --panel: rgba(255, 255, 255, 0.92);
      --card: rgba(255, 255, 255, 0.9);
      --card2: rgba(248, 250, 252, 0.95);
      --text: #0f172a;
      --muted: #64748b;
      --border: rgba(148, 163, 184, 0.35);
      --border2: rgba(148, 163, 184, 0.55);
      --accent: #16a34a;
      --accent2: rgba(22, 163, 74, 0.14);
      --shadow: 0 18px 45px rgba(148,163,184,0.35);
      --codebg: #f1f5f9;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    body{
      font-family: var(--font-main);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 1.4rem;
      display:flex;
      justify-content:center;
    }

    .app{
      width: 100%;
      max-width: 1200px;
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      box-shadow: var(--shadow);
      overflow:hidden;
      background: var(--panel);
      backdrop-filter: blur(14px);
    }

    header{
      padding: 1.15rem 1.2rem 1rem;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(135deg, var(--accent2), transparent 55%);
    }
    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:1rem;
      flex-wrap:wrap;
    }
    .brand{
      display:flex;
      gap:0.75rem;
      align-items:center;
    }
    .logo{
      width: 42px; height: 42px;
      border-radius: 999px;
      border: 2px solid var(--accent);
      display:flex; align-items:center; justify-content:center;
      font-weight: 750;
      font-family: var(--font-mono);
      color: var(--accent);
      background: var(--card2);
    }
    h1{
      font-size: 1.25rem;
      letter-spacing: 0.02em;
      margin-bottom: 0.2rem;
    }
    .subtitle{
      color: var(--muted);
      font-size: 0.9rem;
      max-width: 60ch;
      line-height: 1.35;
    }

    .actions{
      display:flex;
      gap:0.55rem;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      border-radius: var(--r-pill);
      padding: 0.35rem 0.75rem;
      font-size: 0.82rem;
      cursor:pointer;
      display:inline-flex;
      gap:0.35rem;
      align-items:center;
      transition: transform .08s ease, border-color .12s ease;
      user-select:none;
      white-space: nowrap;
    }
    .btn:hover{ transform: translateY(-1px); border-color: var(--accent); }
    .btn:active{ transform: translateY(1px); }

    .layout{
      display:grid;
      grid-template-columns: 320px 1fr;
      min-height: calc(100vh - 180px);
    }
    @media (max-width: 980px){
      .layout{ grid-template-columns: 1fr; }
      .sidebar{ position: static; border-right: none !important; }
    }

    nav.sidebar{
      border-right: 1px solid var(--border);
      background: var(--card2);
      padding: 0.85rem;
      position: sticky;
      top: 0;
      align-self: start;
      height: fit-content;
    }

    .search{
      display:flex;
      gap:0.4rem;
      align-items:center;
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: var(--r-pill);
      padding: 0.35rem 0.75rem;
      margin-bottom: 0.7rem;
    }
    .search input{
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      width: 100%;
      font-size: 0.88rem;
    }
    .search input::placeholder{ color: var(--muted); }

    .unitlist{
      display:flex;
      flex-direction:column;
      gap:0.45rem;
    }
    .unitlink{
      text-decoration:none;
      color: var(--text);
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: var(--r-md);
      padding: 0.6rem 0.65rem;
      display:flex;
      flex-direction:column;
      gap:0.15rem;
      transition: transform .10s ease, border-color .12s ease;
    }
    .unitlink:hover{ transform: translateY(-2px); border-color: var(--accent); }
    .unitlink small{ color: var(--muted); font-size: 0.75rem; }

    main{
      padding: 1rem 1.05rem 1.2rem;
    }

    article.unit{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      padding: 1rem 1.05rem;
      margin-bottom: 0.9rem;
    }

    .unit header{
      border: none;
      background: none;
      padding: 0;
      margin-bottom: 0.65rem;
    }

    .unit-title{
      display:flex;
      align-items:baseline;
      gap:0.6rem;
      flex-wrap:wrap;
    }
    .badge{
      border: 1px solid var(--border2);
      background: var(--accent2);
      color: var(--text);
      border-radius: var(--r-pill);
      padding: 0.18rem 0.55rem;
      font-size: 0.78rem;
    }
    .meta{
      color: var(--muted);
      font-size: 0.85rem;
      line-height: 1.35;
      margin-top: 0.25rem;
    }

    section.block{
      margin-top: 0.85rem;
      padding-top: 0.75rem;
      border-top: 1px dashed var(--border);
    }
    section.block h3{
      font-size: 1rem;
      margin-bottom: 0.35rem;
    }
    section.block p{
      color: var(--text);
      line-height: 1.55;
      font-size: 0.95rem;
      margin-bottom: 0.6rem;
    }
    ul, ol{
      padding-left: 1.2rem;
      margin: 0.45rem 0 0.7rem;
      color: var(--text);
      line-height: 1.55;
    }
    li{ margin: 0.22rem 0; }

    figure{
      margin: 0.8rem 0;
      border: 1px solid var(--border);
      border-radius: var(--r-md);
      overflow:hidden;
      background: var(--card2);
    }
    figure img{
      width:100%;
      display:block;
      max-height: 340px;
      object-fit: cover;
    }
    figcaption{
      padding: 0.55rem 0.7rem;
      color: var(--muted);
      font-size: 0.82rem;
    }

    details{
      margin-top: 0.55rem;
      border: 1px solid var(--border);
      border-radius: var(--r-md);
      background: var(--card2);
      padding: 0.55rem 0.7rem;
    }
    summary{
      cursor:pointer;
      font-weight: 650;
    }
    details p, details li{
      color: var(--text);
      font-weight: 400;
    }

    pre{
      background: var(--codebg);
      border: 1px solid var(--border);
      border-radius: var(--r-md);
      padding: 0.7rem 0.8rem;
      overflow:auto;
      margin: 0.65rem 0;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      line-height: 1.45;
    }
    code{ font-family: var(--font-mono); }

    footer.app-footer{
      border-top: 1px solid var(--border);
      padding: 0.8rem 1.1rem;
      color: var(--muted);
      font-size: 0.82rem;
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:0.4rem;
      background: var(--card2);
    }

    /* Print: deja la teor√≠a limpia */
    @media print{
      body{ background: #fff; padding:0; }
      .app{ box-shadow:none; border:none; border-radius:0; }
      nav.sidebar, .actions{ display:none !important; }
      header{ border-bottom: 1px solid #ddd; background:none; }
      article.unit{ break-inside: avoid; }
      a{ color: #000; text-decoration:none; }
    }

    /* ---------- Modal (HTML5 dialog) ---------- */
dialog.unit-modal {
  width: min(980px, calc(100vw - 2.2rem));
  max-height: min(86vh, 900px);
  border: 1px solid var(--border);
  border-radius: var(--r-lg);
  background: var(--panel);
  color: var(--text);
  box-shadow: var(--shadow);
  padding: 0;
  overflow: hidden;
}

/* Backdrop */
dialog.unit-modal::backdrop {
  background: rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(6px);
}

/* Animaci√≥n entrada/salida (aprovecha CSS3) */
dialog.unit-modal {
  opacity: 0;
  transform: translateY(14px) scale(0.985);
  transition: opacity .18s ease, transform .18s ease;
}
dialog.unit-modal[open] {
  opacity: 1;
  transform: translateY(0) scale(1);
}

/* Cabecera modal */
.modal-head {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 0.8rem;
  padding: 0.95rem 1rem;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(135deg, var(--accent2), transparent 60%);
}

.modal-title {
  display: flex;
  align-items: baseline;
  flex-wrap: wrap;
  gap: 0.6rem;
}
.modal-title h2 {
  font-size: 1.15rem;
  margin: 0;
}
.modal-meta {
  color: var(--muted);
  font-size: 0.85rem;
  margin-top: 0.25rem;
  line-height: 1.35;
}

/* Cuerpo modal */
.modal-body {
  padding: 1rem 1.05rem 1.2rem;
  background: var(--panel);
  overflow: auto;
  max-height: calc(86vh - 72px);
}

/* Bot√≥n cerrar */
.modal-close {
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
  border-radius: var(--r-pill);
  padding: 0.35rem 0.75rem;
  font-size: 0.82rem;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  white-space: nowrap;
}
.modal-close:hover { border-color: var(--accent); transform: translateY(-1px); }
.modal-close:active { transform: translateY(1px); }

/* Bot√≥n "Abrir" dentro de cada tarjeta del √≠ndice */
.open-pill {
  margin-left: auto;
  border-radius: var(--r-pill);
  padding: 0.12rem 0.5rem;
  border: 1px solid var(--border2);
  background: var(--accent2);
  color: var(--text);
  font-size: 0.72rem;
}

/* Cuando modal est√° abierto, suavizamos el contenido de fondo */
body.modal-open .app {
  filter: blur(2px) saturate(0.95);
  transform: scale(0.995);
  transition: filter .18s ease, transform .18s ease;
}

  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="topbar">
        <div class="brand">
          <div class="logo">TH</div>
          <div>
            <h1>Teor√≠a ‚Äì Material de clase (12 Unidades)</h1>
            <p class="subtitle">
              Navega por unidades, busca conceptos y ampl√≠a el temario a√±adiendo solo texto
              en la configuraci√≥n del archivo.
            </p>
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="themeBtn" type="button" title="Cambiar tema">
            <span id="themeIcon">üåô</span><span id="themeLabel">Oscuro</span>
          </button>
          <button class="btn" id="printBtn" type="button" title="Imprimir / Guardar PDF">
            üñ®Ô∏è <span>Imprimir</span>
          </button>
        </div>
      </div>
    </header>

    <div class="layout">
      <nav class="sidebar" aria-label="√çndice de unidades">
        <div class="search" role="search">
          <span>‚åï</span>
          <input id="q" type="search" placeholder="Buscar en unidades‚Ä¶" aria-label="Buscar texto" />
        </div>

        <div class="unitlist" id="unitList">
          <!-- Links de unidades por JS -->
        </div>
      </nav>

      <main id="content" tabindex="-1">
        <!-- Unidades por JS -->
      </main>
    </div>

    <footer class="app-footer">
      <span>‚úÖ A√±adir una unidad = a√±adir un objeto con texto en <code>UNITS</code>.</span>
      <span>Tip: usa <strong>Ctrl+F</strong> o el buscador lateral para conceptos.</span>
    </footer>
  </div>

  <dialog id="unitModal" class="unit-modal" aria-label="Unidad">
  <div class="modal-head">
    <div>
      <div class="modal-title">
        <span class="badge" id="mBadge">Unidad</span>
        <h2 id="mTitle">T√≠tulo</h2>
      </div>
      <p class="modal-meta" id="mSummary"></p>
    </div>

    <button class="modal-close" id="mClose" type="button">
      ‚úï <span>Cerrar</span>
    </button>
  </div>

  <div class="modal-body" id="mBody">
    <!-- Contenido unidad por JS -->
  </div>
  </dialog>

  
  <script>
    /*
      ‚úÖ C√ìMO A√ëADIR UNA UNIDAD (sin tocar HTML):
      1) Copia el objeto de la Unidad 1.
      2) Cambia id, title, summary y blocks (texto).
      3) Si quieres, a√±ade 'figure' con una imagen (ruta local).
      4) Listo: el √≠ndice y el contenido se generan solos.
    */

    const UNITS = [
      {
  id: "u1",
  number: 1,
  title: "Unidad 1 ‚Äî Matem√°tica discreta y teor√≠a de n√∫meros para seguridad digital",
  summary:
    "Introducci√≥n a los fundamentos que sostienen criptograf√≠a y blockchain: n√∫meros primos, divisibilidad, congruencias, algoritmo de Euclides y teorema fundamental de la aritm√©tica. Se conectan con RSA, funciones hash, ECC y pruebas de conocimiento cero.",

  blocks: [
    {
      h3: "1.1 ¬øPor qu√© matem√°tica discreta en criptograf√≠a y blockchain?",
      p: [
        "La matem√°tica discreta estudia estructuras no continuas: enteros, grafos y conjuntos finitos. A diferencia del c√°lculo, aqu√≠ trabajamos con objetos contables y reglas exactas.",
        "En seguridad digital es clave porque criptograf√≠a y blockchain dependen de propiedades de los enteros: primos, divisibilidad y aritm√©tica modular. Esto permite proteger informaci√≥n, autenticar identidades y validar transacciones de forma verificable."
      ],
      ul: [
        "Criptograf√≠a: protege confidencialidad e integridad usando problemas matem√°ticos dif√≠ciles (ej. factorizaci√≥n).",
        "Blockchain: asegura inmutabilidad usando hashes y mecanismos criptogr√°ficos basados en aritm√©tica modular.",
        "Objetivo de la unidad: construir base matem√°tica para el resto del curso con ejemplos y ejercicios."
      ]
    },

    {
      h3: "1.2 N√∫meros primos: los ‚Äúladrillos‚Äù de la seguridad",
      p: [
        "Un n√∫mero primo solo es divisible por 1 y por s√≠ mismo. Su importancia en criptograf√≠a viene de una asimetr√≠a: multiplicar primos es f√°cil, pero factorizar un n√∫mero grande en primos es muy dif√≠cil.",
        "Esto sustenta RSA (producto de dos primos grandes) y tambi√©n aparece en generaci√≥n de claves (tests de primalidad) y en sistemas modernos como ECC."
      ],
      ul: [
        "Ejemplos de primos: 2, 3, 5, 7, 11, 13, 17, 19‚Ä¶",
        "Idea central: verificaci√≥n f√°cil vs inversi√≥n dif√≠cil (base de la criptograf√≠a moderna).",
        "Pruebas de primalidad: Fermat y Miller‚ÄìRabin (probabil√≠sticas) para generar primos grandes."
      ]
    },

    {
      h3: "1.3 Divisibilidad: definici√≥n, propiedades y por qu√© importa",
      p: [
        "Decimos que a divide a b (a | b) si existe un entero k tal que b = a¬∑k. Este concepto permite razonar sobre factores, MCD y algoritmos eficientes.",
        "En criptograf√≠a es esencial porque la factorizaci√≥n y la aritm√©tica modular se apoyan en estas relaciones."
      ],
      ul: [
        "Transitividad: si a|b y b|c ‚áí a|c.",
        "Suma/resta: si a|b y a|c ‚áí a|(b+c) y a|(b‚àíc).",
        "Multiplicaci√≥n: si a|b ‚áí a|(b¬∑c) para cualquier entero c."
      ]
    },

    {
      h3: "1.4 Divisi√≥n euclidiana y algoritmo de Euclides (MCD)",
      p: [
        "La divisi√≥n euclidiana dice que para enteros a y b (b‚â†0) existen q y r √∫nicos tales que a = bq + r con 0 ‚â§ r < |b|. Esta idea es la base del algoritmo de Euclides.",
        "El algoritmo de Euclides calcula el MCD de forma muy eficiente: MCD(a,b)=MCD(b, a mod b). Se repite hasta que el residuo sea 0. En criptograf√≠a es clave para comprobar coprimalidad y calcular inversos modulares (versi√≥n extendida)."
      ],
      code:
`Ejemplo: MCD(252, 105)
252 = 105¬∑2 + 42   ‚Üí MCD(252,105)=MCD(105,42)
105 = 42¬∑2 + 21    ‚Üí MCD(105,42)=MCD(42,21)
42  = 21¬∑2 + 0     ‚Üí MCD = 21`
    },

    {
      h3: "1.5 Teorema Fundamental de la Aritm√©tica",
      p: [
        "Todo entero n>1 puede expresarse de manera √∫nica (salvo orden) como producto de n√∫meros primos. Esta unicidad es una piedra angular de la teor√≠a de n√∫meros.",
        "En seguridad digital, se aprovecha que es f√°cil multiplicar y verificar, pero muy dif√≠cil reconstruir los primos cuando los n√∫meros son enormes (caso RSA)."
      ],
      code:
`Ejemplo: 360 = 2^3 ¬∑ 3^2 ¬∑ 5
La factorizaci√≥n es √∫nica (salvo el orden de los factores).`
    },

    {
      h3: "1.6 Aplicaciones directas en criptograf√≠a y blockchain",
      p: [
        "Los conceptos anteriores se reflejan en sistemas reales. RSA usa factorizaci√≥n; las funciones hash garantizan integridad y efecto avalancha; ECC logra la misma seguridad con claves m√°s peque√±as; y las pruebas de conocimiento cero permiten demostrar algo sin revelar el secreto.",
        "Tambi√©n se introduce el impacto de la computaci√≥n cu√°ntica (Shor) como reto para RSA, motivando la criptograf√≠a poscu√°ntica."
      ],
      ul: [
        "RSA: seguridad basada en la dificultad de factorizar n = p¬∑q (primos grandes).",
        "Hash en blockchain: sellan bloques; peque√±as variaciones ‚áí hash totalmente distinto (avalanchas).",
        "ECC: claves mucho menores para el mismo nivel de seguridad (ideal para m√≥viles/IoT).",
        "ZKP: demostrar que sabes algo (p.ej. contrase√±a) sin enviarlo; casos como Zcash."
      ]
    },

    {
      h3: "1.7 Resultados de aprendizaje y pr√°ctica m√≠nima",
      p: [
        "Al finalizar la unidad, el alumnado debe manejar primos, divisibilidad y congruencias en contextos matem√°ticos y criptogr√°ficos; implementar Euclides (y entender su rol en seguridad); valorar el teorema fundamental y conectar estos conceptos con criptograf√≠a y blockchain."
      ],
      ul: [
        "Ejercicios: identificaci√≥n de primos, factorizaci√≥n, congruencias simples, MCD por Euclides.",
        "Mini-pr√°ctica: usar Euclides para comprobar coprimalidad (pre-RSA) y discutir por qu√© eso importa.",
        "Conexi√≥n: explicar con palabras la asimetr√≠a ‚Äúf√°cil multiplicar, dif√≠cil factorizar‚Äù."
      ]
    }
  ],

  // ‚úÖ Imagen sugerida: usa una de las l√°minas que has subido (ver apartado 2).
  figure: {
    src: "img/u1_portada.jpg",
    alt: "Portada unidad 1: teor√≠a de n√∫meros y seguridad digital",
    caption: "Unidad 1: teor√≠a de n√∫meros aplicada a criptograf√≠a y blockchain."
  },

  extras: [
    {
      title: "Notas del profesor (para guiar la sesi√≥n)",
      p: [
        "Enfatiza el patr√≥n did√°ctico: (1) concepto ‚Üí (2) ejemplo peque√±o ‚Üí (3) conexi√≥n con seguridad real.",
        "Cuando llegues a RSA: recalca que la seguridad no est√° en ocultar el algoritmo, sino en la dificultad matem√°tica del problema.",
        "Si hay tiempo: introduce ‚Äúcoprimo‚Äù y por qu√© el inverso modular es la pieza clave del descifrado."
      ]
    }
  ]
},
    ];

    // ---------- Render ----------
    const unitList = document.getElementById("unitList");
    const content = document.getElementById("content");
    const q = document.getElementById("q");

    function esc(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }

    function renderUnits(filterTerm = "") {
      const term = filterTerm.trim().toLowerCase();

      const filtered = !term ? UNITS : UNITS.filter(u => {
        const hay = [
          u.title, u.summary,
          ...(u.blocks||[]).flatMap(b => [b.h3, ...(b.p||[]), ...(b.ul||[]), ...(b.ol||[]), b.code||""])
        ].join(" ").toLowerCase();
        return hay.includes(term);
      });

      // Sidebar
      // Sidebar
unitList.innerHTML = "";
filtered.forEach(u => {
  const a = document.createElement("a");
  a.className = "unitlink";
  a.href = `#${u.id}`; // sigue funcionando para accesibilidad
  a.setAttribute("data-open-unit", u.id);

  const titleShort = (u.title || "").replace(/^Unidad\s+\d+\s+‚Äî\s*/i, "");
  a.innerHTML = `
    <strong>Unidad ${u.number}</strong>
    <small>${esc(titleShort)}</small>
    <span class="open-pill">Abrir</span>
  `;
  unitList.appendChild(a);
});


      // Content
      content.innerHTML = "";
      if (!filtered.length) {
        content.innerHTML = `<article class="unit"><header><div class="unit-title"><span class="badge">Sin resultados</span><h2 style="font-size:1.1rem;">No se encontr√≥ nada con ese texto</h2></div></header><p class="meta">Prueba con otra palabra clave.</p></article>`;
        return;
      }

      filtered.forEach(u => {
        const art = document.createElement("article");
        art.className = "unit";
        art.id = u.id;

        const titleClean = u.title || `Unidad ${u.number}`;
        const summary = u.summary || "";

        let figureHTML = "";
        if (u.figure && u.figure.src) {
          figureHTML = `
            <figure>
              <img src="${esc(u.figure.src)}" alt="${esc(u.figure.alt||"Imagen de unidad")}" loading="lazy">
              <figcaption>${esc(u.figure.caption||"")}</figcaption>
            </figure>
          `;
        }

        const blocksHTML = (u.blocks||[]).map(b => {
          const pHTML = (b.p||[]).map(t => `<p>${esc(t)}</p>`).join("");
          const ulHTML = b.ul?.length ? `<ul>${b.ul.map(li => `<li>${esc(li)}</li>`).join("")}</ul>` : "";
          const olHTML = b.ol?.length ? `<ol>${b.ol.map(li => `<li>${esc(li)}</li>`).join("")}</ol>` : "";
          const codeHTML = b.code ? `<pre><code>${esc(b.code)}</code></pre>` : "";
          return `
            <section class="block">
              <h3>${esc(b.h3||"")}</h3>
              ${pHTML}
              ${ulHTML}
              ${olHTML}
              ${codeHTML}
            </section>
          `;
        }).join("");

        const extrasHTML = (u.extras||[]).map(ex => {
          const exP = (ex.p||[]).map(t => `<p>${esc(t)}</p>`).join("");
          return `
            <details>
              <summary>${esc(ex.title||"Notas")}</summary>
              ${exP}
            </details>
          `;
        }).join("");

        art.innerHTML = `
          <header>
            <div class="unit-title">
              <span class="badge">Unidad ${u.number}</span>
              <h2 style="font-size:1.15rem;">${esc(titleClean.replace(/^Unidad\\s+\\d+\\s+‚Äî\\s*/i,""))}</h2>
            </div>
            <p class="meta">${esc(summary)}</p>
          </header>

          ${figureHTML}
          ${blocksHTML}
          ${extrasHTML}
        `;

        content.appendChild(art);
      });
    }

    renderUnits("");

    // ---------- Search ----------
    q.addEventListener("input", () => renderUnits(q.value));

    // ---------- Theme toggle ----------
    const THEME_KEY = "teoria-theme";
    const html = document.documentElement;
    const themeBtn = document.getElementById("themeBtn");
    const themeIcon = document.getElementById("themeIcon");
    const themeLabel = document.getElementById("themeLabel");

    function applyTheme(t){
      html.setAttribute("data-theme", t);
      if (t === "dark"){ themeIcon.textContent = "üåô"; themeLabel.textContent = "Oscuro"; }
      else { themeIcon.textContent = "‚òÄÔ∏è"; themeLabel.textContent = "Claro"; }
    }
    const stored = localStorage.getItem(THEME_KEY);
    applyTheme(stored === "light" ? "light" : "dark");

    themeBtn.addEventListener("click", () => {
      const next = html.getAttribute("data-theme") === "dark" ? "light" : "dark";
      applyTheme(next);
      localStorage.setItem(THEME_KEY, next);
    });



    // ---------- Modal open/close ----------
const modal = document.getElementById("unitModal");
const mBadge = document.getElementById("mBadge");
const mTitle = document.getElementById("mTitle");
const mSummary = document.getElementById("mSummary");
const mBody = document.getElementById("mBody");
const mClose = document.getElementById("mClose");

function unitToHTML(u) {
  let figureHTML = "";
  if (u.figure && u.figure.src) {
    figureHTML = `
      <figure>
        <img src="${esc(u.figure.src)}" alt="${esc(u.figure.alt||"Imagen de unidad")}" loading="lazy">
        <figcaption>${esc(u.figure.caption||"")}</figcaption>
      </figure>
    `;
  }

  const blocksHTML = (u.blocks||[]).map(b => {
    const pHTML = (b.p||[]).map(t => `<p>${esc(t)}</p>`).join("");
    const ulHTML = b.ul?.length ? `<ul>${b.ul.map(li => `<li>${esc(li)}</li>`).join("")}</ul>` : "";
    const olHTML = b.ol?.length ? `<ol>${b.ol.map(li => `<li>${esc(li)}</li>`).join("")}</ol>` : "";
    const codeHTML = b.code ? `<pre><code>${esc(b.code)}</code></pre>` : "";
    return `
      <section class="block">
        <h3>${esc(b.h3||"")}</h3>
        ${pHTML}
        ${ulHTML}
        ${olHTML}
        ${codeHTML}
      </section>
    `;
  }).join("");

  const extrasHTML = (u.extras||[]).map(ex => {
    const exP = (ex.p||[]).map(t => `<p>${esc(t)}</p>`).join("");
    return `
      <details>
        <summary>${esc(ex.title||"Notas")}</summary>
        ${exP}
      </details>
    `;
  }).join("");

  return `${figureHTML}${blocksHTML}${extrasHTML}`;
}

function openUnitModal(unitId) {
  const u = UNITS.find(x => x.id === unitId);
  if (!u) return;

  mBadge.textContent = `Unidad ${u.number}`;
  mTitle.textContent = (u.title || "").replace(/^Unidad\s+\d+\s+‚Äî\s*/i, "");
  mSummary.textContent = u.summary || "";
  mBody.innerHTML = unitToHTML(u);

  // abrir
  document.body.classList.add("modal-open");
  if (!modal.open) modal.showModal();
  // foco accesible
  mClose.focus();
}

function closeUnitModal() {
  document.body.classList.remove("modal-open");
  if (modal.open) modal.close();
}

// Click en √≠ndice ‚Üí abrir modal
unitList.addEventListener("click", (e) => {
  const link = e.target.closest("[data-open-unit]");
  if (!link) return;
  e.preventDefault();
  openUnitModal(link.getAttribute("data-open-unit"));
});

// Cerrar con bot√≥n
mClose.addEventListener("click", closeUnitModal);

// Cerrar haciendo click fuera (en backdrop)
modal.addEventListener("click", (e) => {
  const rect = modal.getBoundingClientRect();
  const clickedOutside =
    e.clientX < rect.left || e.clientX > rect.right || e.clientY < rect.top || e.clientY > rect.bottom;
  if (clickedOutside) closeUnitModal();
});

// Soporte: si vienes con #u1 en la URL, abrir directo
window.addEventListener("hashchange", () => {
  const id = location.hash.replace("#", "");
  if (id && UNITS.some(u => u.id === id)) openUnitModal(id);
});
if (location.hash) {
  const id = location.hash.replace("#", "");
  if (id && UNITS.some(u => u.id === id)) openUnitModal(id);
}


    // ---------- Print ----------
    document.getElementById("printBtn").addEventListener("click", () => window.print());
  </script>



</body>
</html>
